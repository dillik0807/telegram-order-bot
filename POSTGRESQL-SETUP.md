# üêò –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL –¥–ª—è Order Bot

## –ü—Ä–æ–±–ª–µ–º–∞
–ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É:
```
‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î: [Error: SQLITE_CANTOPEN: unable to open database file]
```

–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Ç–æ–º—É —á—Ç–æ –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SQLite, –∞ –Ω–∞ Railway –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PostgreSQL.

## –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ PostgreSQL
node switch-to-postgres.js

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# 3. –û–±–Ω–æ–≤–∏—Ç—å .env —Ñ–∞–π–ª
# –î–æ–±–∞–≤—å—Ç–µ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ:
DATABASE_URL=postgresql://user:password@host:port/database

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
npm start
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pg –¥—Ä–∞–π–≤–µ—Ä:**
```bash
npm install pg
```

2. **–ó–∞–º–µ–Ω–∏—Ç–µ database.js:**
```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é
cp database.js database-sqlite.js

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PostgreSQL –≤–µ—Ä—Å–∏—é
cp database-postgres.js database.js
```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env):**
```env
# PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
DATABASE_URL=postgresql://user:password@host:port/database

# –î–ª—è Railway (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è)
# DATABASE_URL —É–∂–µ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Railway
```

4. **–î–ª—è Railway:**
   - Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç `DATABASE_URL`
   - –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å—Ç–µ PostgreSQL —Å–µ—Ä–≤–∏—Å –≤ –ø—Ä–æ–µ–∫—Ç
   - –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `DATABASE_URL` –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## –§–æ—Ä–º–∞—Ç DATABASE_URL

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:
```
DATABASE_URL=postgresql://postgres:password@localhost:5432/orders
```

### Railway (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):
```
DATABASE_URL=postgresql://postgres:xxx@containers-us-west-xxx.railway.app:5432/railway
```

### Heroku (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):
```
DATABASE_URL=postgres://user:pass@host:5432/database
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:
```bash
npm start
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
‚úÖ PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω
‚úÖ –¢–∞–±–ª–∏—Ü—ã PostgreSQL –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
ü§ñ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ!
```

## –í–æ–∑–≤—Ä–∞—Ç –∫ SQLite

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ SQLite:
```bash
node switch-to-sqlite.js
```

## –û—Ç–ª–∏—á–∏—è PostgreSQL –æ—Ç SQLite

| –§—É–Ω–∫—Ü–∏—è | SQLite | PostgreSQL |
|---------|--------|------------|
| –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | `?` | `$1, $2, $3` |
| –ê–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç | `AUTOINCREMENT` | `SERIAL` |
| –î–∞—Ç–∞/–≤—Ä–µ–º—è | `datetime('now')` | `CURRENT_TIMESTAMP` |
| –¢–∏–ø ID | `INTEGER` | `BIGINT` –¥–ª—è telegram_id |
| –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ | –§–∞–π–ª | URL —Å—Ç—Ä–æ–∫–∞ |

## –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ SQLite –∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ PostgreSQL:

1. **–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ SQLite:**
```bash
sqlite3 orders.db .dump > backup.sql
```

2. **–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ SQL –¥–ª—è PostgreSQL:**
   - –ó–∞–º–µ–Ω–∏—Ç–µ `AUTOINCREMENT` –Ω–∞ `SERIAL`
   - –ó–∞–º–µ–Ω–∏—Ç–µ `INTEGER PRIMARY KEY` –Ω–∞ `SERIAL PRIMARY KEY`
   - –û–±–Ω–æ–≤–∏—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–∞—Ç

3. **–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ PostgreSQL:**
```bash
psql $DATABASE_URL < backup.sql
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "relation does not exist"
–¢–∞–±–ª–∏—Ü—ã –Ω–µ —Å–æ–∑–¥–∞–Ω—ã. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ - —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### –û—à–∏–±–∫–∞: "password authentication failed"
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ DATABASE_URL - –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.

### –û—à–∏–±–∫–∞: "connection refused"
PostgreSQL —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π —Ö–æ—Å—Ç/–ø–æ—Ä—Ç.

### –û—à–∏–±–∫–∞: "SSL required"
–î–ª—è production –¥–æ–±–∞–≤—å—Ç–µ SSL:
```javascript
ssl: { rejectUnauthorized: false }
```

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ DATABASE_URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ PostgreSQL —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç `pg`
