# üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL

## –ü—Ä–æ–±–ª–µ–º–∞

–í –ª–æ–≥–∞—Ö Railway –≤–∏–¥–Ω—ã –æ—à–∏–±–∫–∏:
```
ERROR: column o.is_deleted does not exist
ERROR: column o.client_id does not exist
ERROR: column "is_deleted" does not exist
```

## –ü—Ä–∏—á–∏–Ω–∞

–°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ë–î –Ω–∞ Railway –Ω–µ –∏–º–µ–µ—Ç –Ω–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è:
- –ú—è–≥–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞—è–≤–æ–∫ (`is_deleted`, `deleted_at`, `deleted_by`, etc.)
- –°–≤—è–∑–∏ –∑–∞—è–≤–æ–∫ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (`client_id`)

## –†–µ—à–µ–Ω–∏–µ

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∫–æ–ª–æ–Ω–æ–∫.

---

## üöÄ –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Railway CLI (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ø—Ä–æ–µ–∫—Ç—É
railway link

# 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
railway run npm run migrate-postgres
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω–æ —Å Railway DATABASE_URL

```bash
# 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ DATABASE_URL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ .env
# DATABASE_URL=postgresql://postgres:...@postgres.railway.internal:5432/railway

# 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
npm run migrate-postgres
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –î–æ–±–∞–≤–∏—Ç—å –≤ Procfile –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ `Procfile`:
```
release: npm run migrate-postgres
web: npm start
```

---

## üìã –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—è

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã
2. ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É `orders`:
   - `is_deleted` (INTEGER DEFAULT 0)
   - `deleted_at` (TIMESTAMP)
   - `deleted_by` (TEXT)
   - `restored_at` (TIMESTAMP)
   - `restored_by` (TEXT)
   - `client_id` (INTEGER)

3. ‚úÖ –ó–∞–ø–æ–ª–Ω—è–µ—Ç `client_id` –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
4. ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç `whatsapp_group_id` –≤ —Ç–∞–±–ª–∏—Ü—É `warehouses`
5. ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é —Å–∫–ª–∞–¥–æ–≤:
   - –ß–ë–∞–ª—Ö–∏ ‚Üí –ë–∞—Ö–æ—Ä –æ–π–ª —Å–∫–ª–∞–¥
   - –ó–∞–≤–æ–¥–¢–ß ‚Üí —Ç–æ—á–∏–∫ –∞–∑–æ–¥

6. ‚úÖ –í—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–∞–Ω–Ω—ã—Ö

---

## ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥

```
üîÑ –ú–ò–ì–†–ê–¶–ò–Ø POSTGRESQL

üìã DATABASE_URL: postgresql://postgres:***@postgres.railway.internal:5432/railway
‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ!

üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü...
–ù–∞–π–¥–µ–Ω–æ —Ç–∞–±–ª–∏—Ü: 7
  - clients
  - order_items
  - orders
  - products
  - registration_requests
  - users
  - warehouses

üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã orders...
–¢–µ–∫—É—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ orders:
  - id (integer)
  - user_id (integer)
  - warehouse (text)
  - transport_number (text)
  - comment (text)
  - status (text)
  - created_at (timestamp without time zone)

‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∫–æ–ª–æ–Ω–æ–∫ –≤ orders...
  ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞: is_deleted
  ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞: deleted_at
  ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞: deleted_by
  ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞: restored_at
  ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞: restored_by
  ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞: client_id

üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ client_id...
  ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: 15

üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ —Å–∫–ª–∞–¥–æ–≤...
  ‚úÖ –ß–ë–∞–ª—Ö–∏ ‚Üí –ë–∞—Ö–æ—Ä –æ–π–ª —Å–∫–ª–∞–¥
  ‚úÖ –ó–∞–≤–æ–¥–¢–ß ‚Üí —Ç–æ—á–∏–∫ –∞–∑–æ–¥

üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 10
  –ö–ª–∏–µ–Ω—Ç–æ–≤: 8
  –ó–∞—è–≤–æ–∫: 15
  –°–∫–ª–∞–¥–æ–≤: 2
  –¢–æ–≤–∞—Ä–æ–≤: 5

üéâ –ú–ò–ì–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û!
‚úÖ –í—Å–µ –∫–æ–ª–æ–Ω–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
‚úÖ –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
‚úÖ –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã

```sql
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'orders';
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ–ª–æ–Ω–∫–∏:
- `is_deleted`
- `deleted_at`
- `deleted_by`
- `restored_at`
- `restored_by`
- `client_id`

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ

```sql
SELECT COUNT(*) FROM orders WHERE is_deleted = 0;
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

```bash
railway restart
railway logs
```

–ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ –ø—Ä–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏.

---

## üÜò –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "relation does not exist"

–¢–∞–±–ª–∏—Ü–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –æ–¥–∏–Ω —Ä–∞–∑ - —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é.

### –û—à–∏–±–∫–∞: "column already exists"

–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–ø—É—Å—Ç–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏.

### –û—à–∏–±–∫–∞: "permission denied"

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è PostgreSQL. –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ ALTER TABLE.

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ DATABASE_URL:
```bash
echo $DATABASE_URL
```

---

## üìù –†—É—á–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –≤—Ä—É—á–Ω—É—é:

```sql
-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –≤ orders
ALTER TABLE orders ADD COLUMN IF NOT EXISTS is_deleted INTEGER DEFAULT 0;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS deleted_at TIMESTAMP;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS deleted_by TEXT;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS restored_at TIMESTAMP;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS restored_by TEXT;
ALTER TABLE orders ADD COLUMN IF NOT EXISTS client_id INTEGER;

-- –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ client_id
UPDATE orders o
SET client_id = (
    SELECT c.id 
    FROM users u 
    JOIN clients c ON u.telegram_id = c.telegram_id 
    WHERE u.id = o.user_id
)
WHERE client_id IS NULL;

-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ whatsapp_group_id –≤ warehouses
ALTER TABLE warehouses ADD COLUMN IF NOT EXISTS whatsapp_group_id TEXT;

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
UPDATE warehouses SET whatsapp_group_id = '120363419535622239@g.us' WHERE name = '–ß–ë–∞–ª—Ö–∏';
UPDATE warehouses SET whatsapp_group_id = '120363422710745455@g.us' WHERE name = '–ó–∞–≤–æ–¥–¢–ß';
```

---

## üöÄ –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

1. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `railway restart`
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `railway logs`
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É –≤ WhatsApp

---

## üìÖ –ö–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

- ‚úÖ –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞ Railway
- ‚úÖ –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î
- ‚úÖ –ü—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫ –ø—Ä–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏
- ‚úÖ –ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–π –º—è–≥–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 8 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
